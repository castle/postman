{
	"info": {
		"_postman_id": "2b763aac-e4da-45bd-985a-a224e3d80bd1",
		"name": "Castle User Workflows",
		"description": "User stories around the /authenticate endpoint, and managing user devices.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "User Authenticates with Castle for First Time",
			"item": [
				{
					"name": "Authenticate with New Device",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
								"exec": [
									"var responseSchema = {",
									"  \"properties\": {",
									"      \"action\": {",
									"          \"type\": \"string\",",
									"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
									"      },",
									"      \"user_id\": {",
									"          \"type\": \"string\"",
									"      },",
									"      \"device_token\": {",
									"          \"type\": \"string\"",
									"      }",
									"  }",
									"};",
									"",
									"var castleResponse = pm.response.json();",
									"var expectedAction = \"allow\";",
									"",
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Castle returns action: \" + expectedAction, function () {",
									"    pm.expect(castleResponse.action).to.eql(expectedAction);",
									"})",
									"",
									"pm.test('Schema is valid', function() {",
									"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
									"});",
									"",
									"pm.environment.set(\"user_id\", castleResponse.user_id);",
									"pm.environment.set(\"device_token\", castleResponse.device_token);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
								"exec": [
									"var uuid = require('uuid');",
									"",
									"var uniqueClientId = uuid.v4();",
									"var uniqueUserId = uuid.v4();",
									"",
									"pm.environment.set(\"client_id\", uniqueClientId);",
									"pm.environment.set(\"user_id\", uniqueUserId);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
						},
						"url": {
							"raw": "https://api.castle.io/v1/authenticate",
							"protocol": "https",
							"host": [
								"api",
								"castle",
								"io"
							],
							"path": [
								"v1",
								"authenticate"
							]
						},
						"description": "Castle /authenticate endpoint with an 'allow' verdict"
					},
					"response": [
						{
							"name": "Authenticate with Device 1 - Allow",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
								},
								"url": {
									"raw": "https://api.castle.io/v1/authenticate",
									"protocol": "https",
									"host": [
										"api",
										"castle",
										"io"
									],
									"path": [
										"v1",
										"authenticate"
									]
								}
							},
							"status": "Created",
							"code": 201,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Date",
									"value": "Mon, 03 Jun 2019 17:13:36 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "204"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "ETag",
									"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
								},
								{
									"key": "Cache-Control",
									"value": "max-age=0, private, must-revalidate"
								},
								{
									"key": "X-Request-Id",
									"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
								},
								{
									"key": "Server",
									"value": "castle.io"
								}
							],
							"cookie": [],
							"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
						},
						{
							"name": "call to /v1/authenticate",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
								},
								"url": {
									"raw": "https://api.castle.io/v1/authenticate",
									"protocol": "https",
									"host": [
										"api",
										"castle",
										"io"
									],
									"path": [
										"v1",
										"authenticate"
									]
								}
							},
							"status": "Created",
							"code": 201,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Date",
									"value": "Fri, 07 Jun 2019 21:18:53 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "228"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "ETag",
									"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
								},
								{
									"key": "Cache-Control",
									"value": "max-age=0, private, must-revalidate"
								},
								{
									"key": "X-Request-Id",
									"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
								},
								{
									"key": "Server",
									"value": "castle.io"
								}
							],
							"cookie": [],
							"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
						}
					]
				},
				{
					"name": "Device is Listed in User Devices",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "7cc3e9aa-047c-4f58-8a05-3ffad9867800",
								"exec": [
									"// Ideally, someday Castle hosts schemas at a public endpoint",
									"// and the test script fetches the schemas and assigns them to",
									"// local env variables via a pre-test script",
									"",
									"// Currently, the schema is copied/pasted from user-device.json",
									"",
									"var responseSchema = {",
									"    \"$schema\": \"http://json-schema.org/draft-07/schema\",",
									"    \"$id\": \"https://castle.io/schemas/user-device.json\",",
									"    \"type\": \"object\",",
									"    \"title\": \"User Device\",",
									"    \"required\": [",
									"        \"total_count\",",
									"        \"data\"",
									"    ],",
									"    \"properties\": {",
									"        \"total_count\": {",
									"            \"type\": \"number\",",
									"            \"examples\": [",
									"                3",
									"            ]",
									"        },",
									"        \"data\": {",
									"            \"type\": \"array\",",
									"            \"uniqueItems\": true,",
									"            \"items\": {",
									"                \"$ref\": \"#/definitions/user_device\"",
									"            }",
									"        }",
									"    },",
									"    \"definitions\": {",
									"        \"user_device\": {",
									"            \"$id\": \"#/definitions/user_device\",",
									"            \"title\": \"Device Schema\",",
									"            \"description\": \"Details about a single device of a user\",",
									"            \"type\": \"object\",",
									"            \"required\": [",
									"                \"token\",",
									"                \"created_at\"",
									"            ],",
									"            \"properties\": {",
									"                \"token\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [",
									"                        \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6ImhZeDNtRVN4RzJFTDdmM21ZcGdweERqNjhTR0ptVmRwIiwidmVyc2lvbiI6MC4xfQ.MlbMcKeo95H0-YpvHXD8OMFydmIVqmNKTZVfS6gWXDM\"",
									"                    ]",
									"                },",
									"                \"created_at\": {",
									"                    \"type\": \"string\",",
									"                    \"format\": \"date-time\",",
									"                    \"examples\": [\"2019-06-01T00:04:40.057Z\"]",
									"                },",
									"                \"last_seen_at\": {",
									"                    \"type\": \"string\",",
									"                    \"format\": \"date-time\",",
									"                    \"examples\": [\"2019-06-03T17:15:04.023Z\"]",
									"                },",
									"                \"approved_at\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"format\": \"date-time\"",
									"                },",
									"                \"escalated_at\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"format\": \"date-time\"",
									"                },",
									"                \"mitigated_at\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"format\": \"date-time\"",
									"                },",
									"                \"context\": {",
									"                    \"$ref\": \"#/definitions/context\"",
									"                },",
									"                \"is_current_device\": {",
									"                    \"type\": \"boolean\"",
									"                }",
									"            }",
									"        },",
									"        \"context\": {",
									"            \"id\": \"#/definitions/context\",",
									"            \"title\": \"Context Schema\",",
									"            \"description\": \"The originating http request context\",",
									"            \"type\": \"object\",",
									"            \"properties\": {",
									"                \"ip\": {",
									"                    \"type\": \"string\",",
									"                    \"format\": \"ipv4\",",
									"                    \"examples\": [\"172.112.41.67\"]",
									"                },",
									"                \"location\": {",
									"                    \"$ref\": \"#/definitions/location\"",
									"                },",
									"                \"user_agent\": {",
									"                    \"$ref\": \"#/definitions/user_agent\"",
									"                },",
									"                \"properties\": {",
									"                    \"type\": \"object\"",
									"                },",
									"                \"type\": {",
									"                    \"type\": \"string\"",
									"                }",
									"            }",
									"        },",
									"        \"location\": {",
									"            \"id\": \"#/definitions/location\",",
									"            \"title\": \"Location Schema\",",
									"            \"description\": \"An object with properties that describe a geographic location\",",
									"            \"type\": \"object\",",
									"            \"properties\": {",
									"                \"country_code\": {",
									"                    \"type\": \"string\",",
									"                    \"minLength\": 2,",
									"                    \"maxLength\": 2,",
									"                    \"examples\": [\"US\"]",
									"                },",
									"                \"country\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"United States\"]",
									"                },",
									"                \"region\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"examples\": [\"California\"]",
									"                },",
									"                \"region_code\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"examples\": [\"CA\"]",
									"                },",
									"                \"city\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"examples\": [\"Garden Grove\"]",
									"                },",
									"                \"lat\": {",
									"                    \"type\": \"number\",",
									"                    \"examples\": [33.7832]",
									"                },",
									"                \"lon\": {",
									"                    \"type\": \"number\",",
									"                    \"examples\": [-117.9773]",
									"                }",
									"            }",
									"        },",
									"        \"user_agent\": {",
									"            \"id\": \"#/definitions/user_agent\",",
									"            \"title\": \"User Agent Schema\",",
									"            \"description\": \"The User Agent details of the originating request (i.e. browser, platform, versions, etc)\",",
									"            \"type\": \"object\",",
									"            \"required\": [\"raw\"],",
									"            \"properties\": {",
									"                \"raw\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.1.1 Safari/605.1.15\"]",
									"                },",
									"                \"browser\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Safari\"]",
									"                },",
									"                \"version\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"12.1.1\"]",
									"                },",
									"                \"os\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Mac OS X 10.14.5\"]",
									"                },",
									"                \"mobile\": {",
									"                    \"type\": \"boolean\",",
									"                    \"examples\": [false]",
									"                },",
									"                \"platform\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Mac OS X\"]",
									"                },",
									"                \"device\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Unknown\"]",
									"                },",
									"                \"family\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Safari\"]",
									"                }",
									"            }",
									"        }",
									"    }",
									"};",
									"",
									"var deviceToken = pm.environment.get(\"device_token\");",
									"var response = pm.response.json();",
									"",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Schema is valid', function() {",
									"  pm.expect(tv4.validate(response, responseSchema)).to.be.true;",
									"});",
									"",
									"pm.test(\"Device is listed\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data[0].token).to.eql(deviceToken);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://api.castle.io/v1/users/{{user_id}}/devices",
							"protocol": "https",
							"host": [
								"api",
								"castle",
								"io"
							],
							"path": [
								"v1",
								"users",
								"{{user_id}}",
								"devices"
							]
						},
						"description": "Devices endpoint lists devices for a user"
					},
					"response": [
						{
							"name": "call to /v1/users/{{user_id}}/devices",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "https://api.castle.io/v1/users/{{user_id}}/devices",
									"protocol": "https",
									"host": [
										"api",
										"castle",
										"io"
									],
									"path": [
										"v1",
										"users",
										"{{user_id}}",
										"devices"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Date",
									"value": "Fri, 07 Jun 2019 21:23:39 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Transfer-Encoding",
									"value": "chunked"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "Vary",
									"value": "Accept-Encoding"
								},
								{
									"key": "ETag",
									"value": "W/\"758fd3c0d7c17459fea5ee6f2650fee6\""
								},
								{
									"key": "Cache-Control",
									"value": "max-age=0, private, must-revalidate"
								},
								{
									"key": "X-Request-Id",
									"value": "46942a0f-f16b-46ac-98fb-a4c86af7222c"
								},
								{
									"key": "Server",
									"value": "castle.io"
								},
								{
									"key": "Content-Encoding",
									"value": "gzip"
								}
							],
							"cookie": [],
							"body": "{\n    \"total_count\": 1,\n    \"data\": [\n        {\n            \"token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\",\n            \"created_at\": \"2019-06-07T21:18:53.464Z\",\n            \"last_seen_at\": \"2019-06-07T21:18:53.408Z\",\n            \"approved_at\": null,\n            \"escalated_at\": null,\n            \"mitigated_at\": null,\n            \"context\": {\n                \"ip\": \"57.155.181.73\",\n                \"location\": {\n                    \"country_code\": \"BE\",\n                    \"country\": \"Belgium\",\n                    \"region\": null,\n                    \"region_code\": null,\n                    \"city\": null,\n                    \"lat\": 50.85,\n                    \"lon\": 4.35\n                },\n                \"user_agent\": {\n                    \"raw\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n                    \"browser\": \"IE\",\n                    \"version\": \"11.0\",\n                    \"os\": \"Windows 8.1 \",\n                    \"mobile\": false,\n                    \"platform\": \"Windows 8.1\",\n                    \"device\": \"Unknown\",\n                    \"family\": \"IE\"\n                },\n                \"properties\": {},\n                \"type\": \"desktop\"\n            },\n            \"is_current_device\": false\n        }\n    ]\n}"
						}
					]
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "7bce429c-484b-4c0c-a9ea-42c02b454128",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "6d7a8527-27d4-46b1-9a34-5d3fe2020de2",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "User's Device is Revoked",
			"item": [
				{
					"name": "Authenticate with New Device",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
								"exec": [
									"var responseSchema = {",
									"  \"properties\": {",
									"      \"action\": {",
									"          \"type\": \"string\",",
									"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
									"      },",
									"      \"user_id\": {",
									"          \"type\": \"string\"",
									"      },",
									"      \"device_token\": {",
									"          \"type\": \"string\"",
									"      }",
									"  }",
									"};",
									"",
									"var castleResponse = pm.response.json();",
									"var expectedAction = \"allow\";",
									"",
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Castle returns action: \" + expectedAction, function () {",
									"    pm.expect(castleResponse.action).to.eql(expectedAction);",
									"})",
									"",
									"pm.test('Schema is valid', function() {",
									"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
									"});",
									"",
									"pm.environment.set(\"user_id\", castleResponse.user_id);",
									"pm.environment.set(\"device_token\", castleResponse.device_token);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
								"exec": [
									"var uuid = require('uuid');",
									"",
									"var uniqueClientId = uuid.v4();",
									"var uniqueUserId = uuid.v4();",
									"var userEmail = uniqueUserId + '@castle.io';",
									"",
									"pm.environment.set(\"client_id\", uniqueClientId);",
									"pm.environment.set(\"user_id\", uniqueUserId);",
									"pm.environment.set(\"user_email\", userEmail);",
									"pm.environment.set(\"registered_at\", Date.now());"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_email}}\",\n        \"registered_at\": \"{{registered_at}}\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
						},
						"url": {
							"raw": "https://api.castle.io/v1/authenticate",
							"protocol": "https",
							"host": [
								"api",
								"castle",
								"io"
							],
							"path": [
								"v1",
								"authenticate"
							]
						},
						"description": "Castle /authenticate endpoint with an 'allow' verdict"
					},
					"response": [
						{
							"name": "call to /v1/authenticate",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
								},
								"url": {
									"raw": "https://api.castle.io/v1/authenticate",
									"protocol": "https",
									"host": [
										"api",
										"castle",
										"io"
									],
									"path": [
										"v1",
										"authenticate"
									]
								}
							},
							"status": "Created",
							"code": 201,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Date",
									"value": "Fri, 07 Jun 2019 21:18:53 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "228"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "ETag",
									"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
								},
								{
									"key": "Cache-Control",
									"value": "max-age=0, private, must-revalidate"
								},
								{
									"key": "X-Request-Id",
									"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
								},
								{
									"key": "Server",
									"value": "castle.io"
								}
							],
							"cookie": [],
							"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
						},
						{
							"name": "Authenticate with Device 1 - Allow",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
								},
								"url": {
									"raw": "https://api.castle.io/v1/authenticate",
									"protocol": "https",
									"host": [
										"api",
										"castle",
										"io"
									],
									"path": [
										"v1",
										"authenticate"
									]
								}
							},
							"status": "Created",
							"code": 201,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Date",
									"value": "Mon, 03 Jun 2019 17:13:36 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "204"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "ETag",
									"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
								},
								{
									"key": "Cache-Control",
									"value": "max-age=0, private, must-revalidate"
								},
								{
									"key": "X-Request-Id",
									"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
								},
								{
									"key": "Server",
									"value": "castle.io"
								}
							],
							"cookie": [],
							"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
						}
					]
				},
				{
					"name": "Device is Listed in User Devices",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "7cc3e9aa-047c-4f58-8a05-3ffad9867800",
								"exec": [
									"// Ideally, someday Castle hosts schemas at a public endpoint",
									"// and the test script fetches the schemas and assigns them to",
									"// local env variables via a pre-test script",
									"",
									"// Currently, the schema is copied/pasted from user-device.json",
									"",
									"var responseSchema = {",
									"    \"$schema\": \"http://json-schema.org/draft-07/schema\",",
									"    \"$id\": \"https://castle.io/schemas/user-device.json\",",
									"    \"type\": \"object\",",
									"    \"title\": \"User Device\",",
									"    \"required\": [",
									"        \"total_count\",",
									"        \"data\"",
									"    ],",
									"    \"properties\": {",
									"        \"total_count\": {",
									"            \"type\": \"number\",",
									"            \"examples\": [",
									"                3",
									"            ]",
									"        },",
									"        \"data\": {",
									"            \"type\": \"array\",",
									"            \"uniqueItems\": true,",
									"            \"items\": {",
									"                \"$ref\": \"#/definitions/user_device\"",
									"            }",
									"        }",
									"    },",
									"    \"definitions\": {",
									"        \"user_device\": {",
									"            \"$id\": \"#/definitions/user_device\",",
									"            \"title\": \"Device Schema\",",
									"            \"description\": \"Details about a single device of a user\",",
									"            \"type\": \"object\",",
									"            \"required\": [",
									"                \"token\",",
									"                \"created_at\"",
									"            ],",
									"            \"properties\": {",
									"                \"token\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [",
									"                        \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6ImhZeDNtRVN4RzJFTDdmM21ZcGdweERqNjhTR0ptVmRwIiwidmVyc2lvbiI6MC4xfQ.MlbMcKeo95H0-YpvHXD8OMFydmIVqmNKTZVfS6gWXDM\"",
									"                    ]",
									"                },",
									"                \"created_at\": {",
									"                    \"type\": \"string\",",
									"                    \"format\": \"date-time\",",
									"                    \"examples\": [\"2019-06-01T00:04:40.057Z\"]",
									"                },",
									"                \"last_seen_at\": {",
									"                    \"type\": \"string\",",
									"                    \"format\": \"date-time\",",
									"                    \"examples\": [\"2019-06-03T17:15:04.023Z\"]",
									"                },",
									"                \"approved_at\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"format\": \"date-time\"",
									"                },",
									"                \"escalated_at\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"format\": \"date-time\"",
									"                },",
									"                \"mitigated_at\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"format\": \"date-time\"",
									"                },",
									"                \"context\": {",
									"                    \"$ref\": \"#/definitions/context\"",
									"                },",
									"                \"is_current_device\": {",
									"                    \"type\": \"boolean\"",
									"                }",
									"            }",
									"        },",
									"        \"context\": {",
									"            \"id\": \"#/definitions/context\",",
									"            \"title\": \"Context Schema\",",
									"            \"description\": \"The originating http request context\",",
									"            \"type\": \"object\",",
									"            \"properties\": {",
									"                \"ip\": {",
									"                    \"type\": \"string\",",
									"                    \"format\": \"ipv4\",",
									"                    \"examples\": [\"172.112.41.67\"]",
									"                },",
									"                \"location\": {",
									"                    \"$ref\": \"#/definitions/location\"",
									"                },",
									"                \"user_agent\": {",
									"                    \"$ref\": \"#/definitions/user_agent\"",
									"                },",
									"                \"properties\": {",
									"                    \"type\": \"object\"",
									"                },",
									"                \"type\": {",
									"                    \"type\": \"string\"",
									"                }",
									"            }",
									"        },",
									"        \"location\": {",
									"            \"id\": \"#/definitions/location\",",
									"            \"title\": \"Location Schema\",",
									"            \"description\": \"An object with properties that describe a geographic location\",",
									"            \"type\": \"object\",",
									"            \"properties\": {",
									"                \"country_code\": {",
									"                    \"type\": \"string\",",
									"                    \"minLength\": 2,",
									"                    \"maxLength\": 2,",
									"                    \"examples\": [\"US\"]",
									"                },",
									"                \"country\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"United States\"]",
									"                },",
									"                \"region\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"examples\": [\"California\"]",
									"                },",
									"                \"region_code\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"examples\": [\"CA\"]",
									"                },",
									"                \"city\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"examples\": [\"Garden Grove\"]",
									"                },",
									"                \"lat\": {",
									"                    \"type\": \"number\",",
									"                    \"examples\": [33.7832]",
									"                },",
									"                \"lon\": {",
									"                    \"type\": \"number\",",
									"                    \"examples\": [-117.9773]",
									"                }",
									"            }",
									"        },",
									"        \"user_agent\": {",
									"            \"id\": \"#/definitions/user_agent\",",
									"            \"title\": \"User Agent Schema\",",
									"            \"description\": \"The User Agent details of the originating request (i.e. browser, platform, versions, etc)\",",
									"            \"type\": \"object\",",
									"            \"required\": [\"raw\"],",
									"            \"properties\": {",
									"                \"raw\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.1.1 Safari/605.1.15\"]",
									"                },",
									"                \"browser\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Safari\"]",
									"                },",
									"                \"version\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"12.1.1\"]",
									"                },",
									"                \"os\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Mac OS X 10.14.5\"]",
									"                },",
									"                \"mobile\": {",
									"                    \"type\": \"boolean\",",
									"                    \"examples\": [false]",
									"                },",
									"                \"platform\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Mac OS X\"]",
									"                },",
									"                \"device\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Unknown\"]",
									"                },",
									"                \"family\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Safari\"]",
									"                }",
									"            }",
									"        }",
									"    }",
									"};",
									"",
									"var deviceToken = pm.environment.get(\"device_token\");",
									"var response = pm.response.json();",
									"",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Schema is valid', function() {",
									"  pm.expect(tv4.validate(response, responseSchema)).to.be.true;",
									"});",
									"",
									"pm.test(\"Device is listed\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data[0].token).to.eql(deviceToken);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://api.castle.io/v1/users/{{user_id}}/devices",
							"protocol": "https",
							"host": [
								"api",
								"castle",
								"io"
							],
							"path": [
								"v1",
								"users",
								"{{user_id}}",
								"devices"
							]
						},
						"description": "Devices endpoint lists devices for a user"
					},
					"response": [
						{
							"name": "call to /v1/users/{{user_id}}/devices",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "https://api.castle.io/v1/users/{{user_id}}/devices",
									"protocol": "https",
									"host": [
										"api",
										"castle",
										"io"
									],
									"path": [
										"v1",
										"users",
										"{{user_id}}",
										"devices"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Date",
									"value": "Fri, 07 Jun 2019 21:23:39 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Transfer-Encoding",
									"value": "chunked"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "Vary",
									"value": "Accept-Encoding"
								},
								{
									"key": "ETag",
									"value": "W/\"758fd3c0d7c17459fea5ee6f2650fee6\""
								},
								{
									"key": "Cache-Control",
									"value": "max-age=0, private, must-revalidate"
								},
								{
									"key": "X-Request-Id",
									"value": "46942a0f-f16b-46ac-98fb-a4c86af7222c"
								},
								{
									"key": "Server",
									"value": "castle.io"
								},
								{
									"key": "Content-Encoding",
									"value": "gzip"
								}
							],
							"cookie": [],
							"body": "{\n    \"total_count\": 1,\n    \"data\": [\n        {\n            \"token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\",\n            \"created_at\": \"2019-06-07T21:18:53.464Z\",\n            \"last_seen_at\": \"2019-06-07T21:18:53.408Z\",\n            \"approved_at\": null,\n            \"escalated_at\": null,\n            \"mitigated_at\": null,\n            \"context\": {\n                \"ip\": \"57.155.181.73\",\n                \"location\": {\n                    \"country_code\": \"BE\",\n                    \"country\": \"Belgium\",\n                    \"region\": null,\n                    \"region_code\": null,\n                    \"city\": null,\n                    \"lat\": 50.85,\n                    \"lon\": 4.35\n                },\n                \"user_agent\": {\n                    \"raw\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n                    \"browser\": \"IE\",\n                    \"version\": \"11.0\",\n                    \"os\": \"Windows 8.1 \",\n                    \"mobile\": false,\n                    \"platform\": \"Windows 8.1\",\n                    \"device\": \"Unknown\",\n                    \"family\": \"IE\"\n                },\n                \"properties\": {},\n                \"type\": \"desktop\"\n            },\n            \"is_current_device\": false\n        }\n    ]\n}"
						}
					]
				},
				{
					"name": "Device is Reported",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "2b862714-5464-45e1-b903-284378a5d8db",
								"exec": [
									"var responseSchema = {",
									"    \"$schema\": \"http://json-schema.org/draft-07/schema\",",
									"    \"$id\": \"https://castle.io/schemas/user-devices.json\",",
									"    \"type\": \"object\",",
									"    \"title\": \"User Device\",",
									"    \"required\": \"data\",",
									"    \"properties\": {",
									"        \"data\": {",
									"            \"type\": \"object\",",
									"            \"$ref\": \"#/definitions/user_device\"",
									"        }",
									"    },",
									"    \"definitions\": {",
									"        \"user_device\": {",
									"            \"$id\": \"#/definitions/user_device\",",
									"            \"title\": \"Device Schema\",",
									"            \"description\": \"Details about a single device of a user\",",
									"            \"type\": \"object\",",
									"            \"required\": [",
									"                \"token\",",
									"                \"created_at\"",
									"            ],",
									"            \"properties\": {",
									"                \"token\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [",
									"                        \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6ImhZeDNtRVN4RzJFTDdmM21ZcGdweERqNjhTR0ptVmRwIiwidmVyc2lvbiI6MC4xfQ.MlbMcKeo95H0-YpvHXD8OMFydmIVqmNKTZVfS6gWXDM\"",
									"                    ]",
									"                },",
									"                \"created_at\": {",
									"                    \"type\": \"string\",",
									"                    \"format\": \"date-time\",",
									"                    \"examples\": [\"2019-06-01T00:04:40.057Z\"]",
									"                },",
									"                \"last_seen_at\": {",
									"                    \"type\": \"string\",",
									"                    \"format\": \"date-time\",",
									"                    \"examples\": [\"2019-06-03T17:15:04.023Z\"]",
									"                },",
									"                \"approved_at\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"format\": \"date-time\"",
									"                },",
									"                \"escalated_at\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"format\": \"date-time\"",
									"                },",
									"                \"mitigated_at\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"format\": \"date-time\"",
									"                },",
									"                \"context\": {",
									"                    \"$ref\": \"#/definitions/context\"",
									"                },",
									"                \"is_current_device\": {",
									"                    \"type\": \"boolean\"",
									"                }",
									"            }",
									"        },",
									"        \"context\": {",
									"            \"id\": \"#/definitions/context\",",
									"            \"title\": \"Context Schema\",",
									"            \"description\": \"The originating http request context\",",
									"            \"type\": \"object\",",
									"            \"properties\": {",
									"                \"ip\": {",
									"                    \"type\": \"string\",",
									"                    \"format\": \"ipv4\",",
									"                    \"examples\": [\"172.112.41.67\"]",
									"                },",
									"                \"location\": {",
									"                    \"$ref\": \"#/definitions/location\"",
									"                },",
									"                \"user_agent\": {",
									"                    \"$ref\": \"#/definitions/user_agent\"",
									"                },",
									"                \"properties\": {",
									"                    \"type\": \"object\"",
									"                },",
									"                \"type\": {",
									"                    \"type\": \"string\"",
									"                }",
									"            }",
									"        },",
									"        \"location\": {",
									"            \"id\": \"#/definitions/location\",",
									"            \"title\": \"Location Schema\",",
									"            \"description\": \"An object with properties that describe a geographic location\",",
									"            \"type\": \"object\",",
									"            \"properties\": {",
									"                \"country_code\": {",
									"                    \"type\": \"string\",",
									"                    \"minLength\": 2,",
									"                    \"maxLength\": 2,",
									"                    \"examples\": [\"US\"]",
									"                },",
									"                \"country\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"United States\"]",
									"                },",
									"                \"region\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"examples\": [\"California\"]",
									"                },",
									"                \"region_code\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"examples\": [\"CA\"]",
									"                },",
									"                \"city\": {",
									"                    \"type\": [",
									"                        \"null\",",
									"                        \"string\"",
									"                    ],",
									"                    \"examples\": [\"Garden Grove\"]",
									"                },",
									"                \"lat\": {",
									"                    \"type\": \"number\",",
									"                    \"examples\": [33.7832]",
									"                },",
									"                \"lon\": {",
									"                    \"type\": \"number\",",
									"                    \"examples\": [-117.9773]",
									"                }",
									"            }",
									"        },",
									"        \"user_agent\": {",
									"            \"id\": \"#/definitions/user_agent\",",
									"            \"title\": \"User Agent Schema\",",
									"            \"description\": \"The User Agent details of the originating request (i.e. browser, platform, versions, etc)\",",
									"            \"type\": \"object\",",
									"            \"required\": [\"raw\"],",
									"            \"properties\": {",
									"                \"raw\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.1.1 Safari/605.1.15\"]",
									"                },",
									"                \"browser\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Safari\"]",
									"                },",
									"                \"version\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"12.1.1\"]",
									"                },",
									"                \"os\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Mac OS X 10.14.5\"]",
									"                },",
									"                \"mobile\": {",
									"                    \"type\": \"boolean\",",
									"                    \"examples\": [false]",
									"                },",
									"                \"platform\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Mac OS X\"]",
									"                },",
									"                \"device\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Unknown\"]",
									"                },",
									"                \"family\": {",
									"                    \"type\": \"string\",",
									"                    \"examples\": [\"Safari\"]",
									"                }",
									"            }",
									"        }",
									"    }",
									"};",
									"",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response adheres to schema\", function () {",
									"    pm.expect(tv4.validate(responseSchema, pm.response.json())).to.be.true;",
									"})"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [],
						"url": {
							"raw": "https://api.castle.io/v1/devices/{{device_token}}/report",
							"protocol": "https",
							"host": [
								"api",
								"castle",
								"io"
							],
							"path": [
								"v1",
								"devices",
								"{{device_token}}",
								"report"
							]
						}
					},
					"response": []
				},
				{
					"name": "Castle Denies Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
								"exec": [
									"var responseSchema = {",
									"  \"properties\": {",
									"      \"action\": {",
									"          \"type\": \"string\",",
									"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
									"      },",
									"      \"user_id\": {",
									"          \"type\": \"string\"",
									"      },",
									"      \"device_token\": {",
									"          \"type\": \"string\"",
									"      }",
									"  }",
									"};",
									"",
									"var castleResponse = pm.response.json();",
									"var expectedAction = \"deny\";",
									"",
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Castle returns action: \" + expectedAction, function () {",
									"    pm.expect(castleResponse.action).to.eql(expectedAction);",
									"})",
									"",
									"pm.test('Schema is valid', function() {",
									"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
						},
						"url": {
							"raw": "https://api.castle.io/v1/authenticate",
							"protocol": "https",
							"host": [
								"api",
								"castle",
								"io"
							],
							"path": [
								"v1",
								"authenticate"
							]
						},
						"description": "Castle /authenticate endpoint with an 'allow' verdict"
					},
					"response": [
						{
							"name": "call to /v1/authenticate",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
								},
								"url": {
									"raw": "https://api.castle.io/v1/authenticate",
									"protocol": "https",
									"host": [
										"api",
										"castle",
										"io"
									],
									"path": [
										"v1",
										"authenticate"
									]
								}
							},
							"status": "Created",
							"code": 201,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Date",
									"value": "Fri, 07 Jun 2019 21:18:53 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "228"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "ETag",
									"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
								},
								{
									"key": "Cache-Control",
									"value": "max-age=0, private, must-revalidate"
								},
								{
									"key": "X-Request-Id",
									"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
								},
								{
									"key": "Server",
									"value": "castle.io"
								}
							],
							"cookie": [],
							"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
						},
						{
							"name": "Authenticate with Device 1 - Allow",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"value": "application/json",
										"type": "text"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
								},
								"url": {
									"raw": "https://api.castle.io/v1/authenticate",
									"protocol": "https",
									"host": [
										"api",
										"castle",
										"io"
									],
									"path": [
										"v1",
										"authenticate"
									]
								}
							},
							"status": "Created",
							"code": 201,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Date",
									"value": "Mon, 03 Jun 2019 17:13:36 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "204"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "ETag",
									"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
								},
								{
									"key": "Cache-Control",
									"value": "max-age=0, private, must-revalidate"
								},
								{
									"key": "X-Request-Id",
									"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
								},
								{
									"key": "Server",
									"value": "castle.io"
								}
							],
							"cookie": [],
							"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
						}
					]
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "8a4a4b81-4fba-48a6-8a8c-d8dbfc11759d",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "1dbc8a34-ab20-4f14-a262-47b85eb2e83a",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Castle Challenges Anomaly Behavior",
			"item": [
				{
					"name": "Challenge is Completed",
					"item": [
						{
							"name": "User Establishes Normal Device Behavior",
							"item": [
								{
									"name": "Authenticate with New Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"var expectedAction = \"allow\";",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test(\"Castle returns action: \" + expectedAction, function () {",
													"    pm.expect(castleResponse.action).to.eql(expectedAction);",
													"})",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"var uniqueUserId = uuid.v4();",
													"",
													"var uniqueIpAddress = generateRandomIp();",
													"",
													"function generateRandomIp () {",
													"    var ip1 = randomIpComponent();",
													"    var ip2 = randomIpComponent();",
													"    var ip3 = randomIpComponent();",
													"    var ip4 = randomIpComponent();",
													"    return ip1 + \".\" + ip2 + \".\" + ip3 + \".\" + ip4;",
													"}",
													"",
													"function randomIpComponent () {",
													"    return Math.floor(Math.random() * 255) + 1;",
													"}",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													"pm.environment.set(\"user_id\", uniqueUserId);",
													"pm.environment.set(\"origin_ip_address\", uniqueIpAddress);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										},
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										}
									]
								},
								{
									"name": "Logout from Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"pm.test(\"Status code is 204\", function () {",
													"    pm.response.to.have.status(204);",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$logout.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/track",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"track"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										},
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										}
									]
								},
								{
									"name": "Authenticate with Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"var expectedAction = \"allow\";",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test(\"Castle returns action: \" + expectedAction, function () {",
													"    pm.expect(castleResponse.action).to.eql(expectedAction);",
													"})",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										},
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										}
									]
								},
								{
									"name": "Logout from Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"pm.test(\"Status code is 204\", function () {",
													"    pm.response.to.have.status(204);",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$logout.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/track",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"track"
											]
										},
										"description": "Track a logout event"
									},
									"response": [
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										},
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										}
									]
								},
								{
									"name": "Authenticate with Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"var expectedAction = \"allow\";",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test(\"Castle returns action: \" + expectedAction, function () {",
													"    pm.expect(castleResponse.action).to.eql(expectedAction);",
													"})",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										},
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										}
									]
								},
								{
									"name": "Logout from Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"pm.test(\"Status code is 204\", function () {",
													"    pm.response.to.have.status(204);",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$logout.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/track",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"track"
											]
										},
										"description": "Track a logout event"
									},
									"response": [
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										},
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										}
									]
								}
							],
							"description": "A user logs in and out with the same device multiple times",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "d3c26a29-24bf-414d-89ed-abd7233c120c",
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "066a941a-48b6-4dc2-bd76-1b04a5939070",
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								}
							],
							"_postman_isSubFolder": true
						},
						{
							"name": "Castle Begins to Challenge Anomalies",
							"item": [
								{
									"name": "Authenticate with New Device 2",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "b834212a-de2b-41c5-b5ce-5e1170e9a3b5",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "ab677012-25f6-40b0-890b-aa282fbea037",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"var uniqueIpAddress = generateRandomIp();",
													"",
													"function generateRandomIp () {",
													"    var ip1 = randomIpComponent();",
													"    var ip2 = randomIpComponent();",
													"    var ip3 = randomIpComponent();",
													"    var ip4 = randomIpComponent();",
													"    return ip1 + \".\" + ip2 + \".\" + ip3 + \".\" + ip4;",
													"}",
													"",
													"function randomIpComponent () {",
													"    return Math.floor(Math.random() * 255) + 1;",
													"}",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													"pm.environment.set(\"origin_ip_address\", uniqueIpAddress);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:13.0) Gecko/20100101 Firefox/13.0.1\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 2 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"d6e688eb-6a8b-4b5e-a2d9-1123c875b4a5-adc2a4e95523609c797ec0c8\",\n        \"ip\": \"232.18.175.111\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:14:38 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"c664b9b352b126fc4e7fa75f5d908fae\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "8bafe1bd-e940-400b-8d11-f7debde0ded1"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6IlpwZXJuNHB4REVGN1doNmNCeERyY3NBMWJrdFp6UGJ6IiwidmVyc2lvbiI6MC4xfQ.eS61Kw1fydgvsXTzaNET3ZgKFmMEO4X5h6j0YqJLQ64\"\n}"
										}
									]
								},
								{
									"name": "Authenticate with New Device 3",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "b834212a-de2b-41c5-b5ce-5e1170e9a3b5",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "ab677012-25f6-40b0-890b-aa282fbea037",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"var uniqueIpAddress = generateRandomIp();",
													"",
													"function generateRandomIp () {",
													"    var ip1 = randomIpComponent();",
													"    var ip2 = randomIpComponent();",
													"    var ip3 = randomIpComponent();",
													"    var ip4 = randomIpComponent();",
													"    return ip1 + \".\" + ip2 + \".\" + ip3 + \".\" + ip4;",
													"}",
													"",
													"function randomIpComponent () {",
													"    return Math.floor(Math.random() * 255) + 1;",
													"}",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													"pm.environment.set(\"origin_ip_address\", uniqueIpAddress);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Opera/9.80 (Windows NT 5.1; U; en) Presto/2.10.229 Version/11.60\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 2 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"d6e688eb-6a8b-4b5e-a2d9-1123c875b4a5-adc2a4e95523609c797ec0c8\",\n        \"ip\": \"232.18.175.111\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:14:38 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"c664b9b352b126fc4e7fa75f5d908fae\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "8bafe1bd-e940-400b-8d11-f7debde0ded1"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6IlpwZXJuNHB4REVGN1doNmNCeERyY3NBMWJrdFp6UGJ6IiwidmVyc2lvbiI6MC4xfQ.eS61Kw1fydgvsXTzaNET3ZgKFmMEO4X5h6j0YqJLQ64\"\n}"
										}
									]
								},
								{
									"name": "Authenticate with New Device 4",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "b834212a-de2b-41c5-b5ce-5e1170e9a3b5",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "ab677012-25f6-40b0-890b-aa282fbea037",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"var uniqueIpAddress = generateRandomIp();",
													"",
													"function generateRandomIp () {",
													"    var ip1 = randomIpComponent();",
													"    var ip2 = randomIpComponent();",
													"    var ip3 = randomIpComponent();",
													"    var ip4 = randomIpComponent();",
													"    return ip1 + \".\" + ip2 + \".\" + ip3 + \".\" + ip4;",
													"}",
													"",
													"function randomIpComponent () {",
													"    return Math.floor(Math.random() * 255) + 1;",
													"}",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													"pm.environment.set(\"origin_ip_address\", uniqueIpAddress);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Linux; Android 6.0.1; SM-G935S Build/MMB29K; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/55.0.2883.91 Mobile Safari/537.36\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 2 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"d6e688eb-6a8b-4b5e-a2d9-1123c875b4a5-adc2a4e95523609c797ec0c8\",\n        \"ip\": \"232.18.175.111\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:14:38 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"c664b9b352b126fc4e7fa75f5d908fae\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "8bafe1bd-e940-400b-8d11-f7debde0ded1"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6IlpwZXJuNHB4REVGN1doNmNCeERyY3NBMWJrdFp6UGJ6IiwidmVyc2lvbiI6MC4xfQ.eS61Kw1fydgvsXTzaNET3ZgKFmMEO4X5h6j0YqJLQ64\"\n}"
										}
									]
								},
								{
									"name": "Authenticate with Suspicious Device",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "fafd705a-c0fe-4f35-99d1-795b8fd2fa04",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.test('Castle Response: action = \"challenge\"', function () {",
													"    pm.expect(castleResponse.action).to.equal('challenge');",
													"})",
													"",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1f6b91c9-1b4d-4b11-b519-d751eec538ca",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"var uniqueIpAddress = generateRandomIp();",
													"",
													"function generateRandomIp () {",
													"    var ip1 = randomIpComponent();",
													"    var ip2 = randomIpComponent();",
													"    var ip3 = randomIpComponent();",
													"    var ip4 = randomIpComponent();",
													"    return ip1 + \".\" + ip2 + \".\" + ip3 + \".\" + ip4;",
													"}",
													"",
													"function randomIpComponent () {",
													"    return Math.floor(Math.random() * 255) + 1;",
													"}",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													"pm.environment.set(\"origin_ip_address\", uniqueIpAddress);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/534.57.2 (KHTML, like Gecko) Version/5.1.7 Safari/534.57.2\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 3 - Challenge",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"1c997bb8-3dce-4130-a494-4193e7812355-adcaf09b02bd4fb87d76651c\",\n        \"ip\": \"172.112.41.67\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:15:04 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "208"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"b6738703f0175dc52853b6e5b9a00e7e\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "b9a6f8e5-c60d-4f26-9af2-862829d8453f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"challenge\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6ImhZeDNtRVN4RzJFTDdmM21ZcGdweERqNjhTR0ptVmRwIiwidmVyc2lvbiI6MC4xfQ.MlbMcKeo95H0-YpvHXD8OMFydmIVqmNKTZVfS6gWXDM\"\n}"
										}
									]
								},
								{
									"name": "Devices are Listed in User Devices",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "7cc3e9aa-047c-4f58-8a05-3ffad9867800",
												"exec": [
													"// Ideally, someday Castle hosts schemas at a public endpoint",
													"// and the test script fetches the schemas and assigns them to",
													"// local env variables via a pre-test script",
													"",
													"// Currently, the schema is copied/pasted from user-device.json",
													"",
													"var responseSchema = {",
													"    \"$schema\": \"http://json-schema.org/draft-07/schema\",",
													"    \"$id\": \"https://castle.io/schemas/user-device.json\",",
													"    \"type\": \"object\",",
													"    \"title\": \"User Device\",",
													"    \"required\": [",
													"        \"total_count\",",
													"        \"data\"",
													"    ],",
													"    \"properties\": {",
													"        \"total_count\": {",
													"            \"type\": \"number\",",
													"            \"examples\": [",
													"                3",
													"            ]",
													"        },",
													"        \"data\": {",
													"            \"type\": \"array\",",
													"            \"uniqueItems\": true,",
													"            \"items\": {",
													"                \"$ref\": \"#/definitions/user_device\"",
													"            }",
													"        }",
													"    },",
													"    \"definitions\": {",
													"        \"user_device\": {",
													"            \"$id\": \"#/definitions/user_device\",",
													"            \"title\": \"Device Schema\",",
													"            \"description\": \"Details about a single device of a user\",",
													"            \"type\": \"object\",",
													"            \"required\": [",
													"                \"token\",",
													"                \"created_at\"",
													"            ],",
													"            \"properties\": {",
													"                \"token\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [",
													"                        \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6ImhZeDNtRVN4RzJFTDdmM21ZcGdweERqNjhTR0ptVmRwIiwidmVyc2lvbiI6MC4xfQ.MlbMcKeo95H0-YpvHXD8OMFydmIVqmNKTZVfS6gWXDM\"",
													"                    ]",
													"                },",
													"                \"created_at\": {",
													"                    \"type\": \"string\",",
													"                    \"format\": \"date-time\",",
													"                    \"examples\": [\"2019-06-01T00:04:40.057Z\"]",
													"                },",
													"                \"last_seen_at\": {",
													"                    \"type\": \"string\",",
													"                    \"format\": \"date-time\",",
													"                    \"examples\": [\"2019-06-03T17:15:04.023Z\"]",
													"                },",
													"                \"approved_at\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"format\": \"date-time\"",
													"                },",
													"                \"escalated_at\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"format\": \"date-time\"",
													"                },",
													"                \"mitigated_at\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"format\": \"date-time\"",
													"                },",
													"                \"context\": {",
													"                    \"$ref\": \"#/definitions/context\"",
													"                },",
													"                \"is_current_device\": {",
													"                    \"type\": \"boolean\"",
													"                }",
													"            }",
													"        },",
													"        \"context\": {",
													"            \"id\": \"#/definitions/context\",",
													"            \"title\": \"Context Schema\",",
													"            \"description\": \"The originating http request context\",",
													"            \"type\": \"object\",",
													"            \"properties\": {",
													"                \"ip\": {",
													"                    \"type\": \"string\",",
													"                    \"format\": \"ipv4\",",
													"                    \"examples\": [\"172.112.41.67\"]",
													"                },",
													"                \"location\": {",
													"                    \"$ref\": \"#/definitions/location\"",
													"                },",
													"                \"user_agent\": {",
													"                    \"$ref\": \"#/definitions/user_agent\"",
													"                },",
													"                \"properties\": {",
													"                    \"type\": \"object\"",
													"                },",
													"                \"type\": {",
													"                    \"type\": \"string\"",
													"                }",
													"            }",
													"        },",
													"        \"location\": {",
													"            \"id\": \"#/definitions/location\",",
													"            \"title\": \"Location Schema\",",
													"            \"description\": \"An object with properties that describe a geographic location\",",
													"            \"type\": \"object\",",
													"            \"properties\": {",
													"                \"country_code\": {",
													"                    \"type\": \"string\",",
													"                    \"minLength\": 2,",
													"                    \"maxLength\": 2,",
													"                    \"examples\": [\"US\"]",
													"                },",
													"                \"country\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"United States\"]",
													"                },",
													"                \"region\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"examples\": [\"California\"]",
													"                },",
													"                \"region_code\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"examples\": [\"CA\"]",
													"                },",
													"                \"city\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"examples\": [\"Garden Grove\"]",
													"                },",
													"                \"lat\": {",
													"                    \"type\": \"number\",",
													"                    \"examples\": [33.7832]",
													"                },",
													"                \"lon\": {",
													"                    \"type\": \"number\",",
													"                    \"examples\": [-117.9773]",
													"                }",
													"            }",
													"        },",
													"        \"user_agent\": {",
													"            \"id\": \"#/definitions/user_agent\",",
													"            \"title\": \"User Agent Schema\",",
													"            \"description\": \"The User Agent details of the originating request (i.e. browser, platform, versions, etc)\",",
													"            \"type\": \"object\",",
													"            \"required\": [\"raw\"],",
													"            \"properties\": {",
													"                \"raw\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.1.1 Safari/605.1.15\"]",
													"                },",
													"                \"browser\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Safari\"]",
													"                },",
													"                \"version\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"12.1.1\"]",
													"                },",
													"                \"os\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Mac OS X 10.14.5\"]",
													"                },",
													"                \"mobile\": {",
													"                    \"type\": \"boolean\",",
													"                    \"examples\": [false]",
													"                },",
													"                \"platform\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Mac OS X\"]",
													"                },",
													"                \"device\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Unknown\"]",
													"                },",
													"                \"family\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Safari\"]",
													"                }",
													"            }",
													"        }",
													"    }",
													"};",
													"",
													"var deviceToken = pm.environment.get(\"device_token\");",
													"var response = pm.response.json();",
													"",
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"  pm.expect(tv4.validate(response, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.test(\"Last device is listed\", function () {",
													"    pm.expect(response.data[0].token).to.eql(deviceToken);",
													"});",
													"",
													"pm.test(\"Device count is 5\", function () {",
													"    pm.expect(response.total_count).to.equal(5);",
													"})"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "https://api.castle.io/v1/users/{{user_id}}/devices",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"users",
												"{{user_id}}",
												"devices"
											]
										},
										"description": "Devices endpoint lists devices for a user"
									},
									"response": [
										{
											"name": "call to /v1/users/{{user_id}}/devices",
											"originalRequest": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "https://api.castle.io/v1/users/{{user_id}}/devices",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"users",
														"{{user_id}}",
														"devices"
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:23:39 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Transfer-Encoding",
													"value": "chunked"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "Vary",
													"value": "Accept-Encoding"
												},
												{
													"key": "ETag",
													"value": "W/\"758fd3c0d7c17459fea5ee6f2650fee6\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "46942a0f-f16b-46ac-98fb-a4c86af7222c"
												},
												{
													"key": "Server",
													"value": "castle.io"
												},
												{
													"key": "Content-Encoding",
													"value": "gzip"
												}
											],
											"cookie": [],
											"body": "{\n    \"total_count\": 1,\n    \"data\": [\n        {\n            \"token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\",\n            \"created_at\": \"2019-06-07T21:18:53.464Z\",\n            \"last_seen_at\": \"2019-06-07T21:18:53.408Z\",\n            \"approved_at\": null,\n            \"escalated_at\": null,\n            \"mitigated_at\": null,\n            \"context\": {\n                \"ip\": \"57.155.181.73\",\n                \"location\": {\n                    \"country_code\": \"BE\",\n                    \"country\": \"Belgium\",\n                    \"region\": null,\n                    \"region_code\": null,\n                    \"city\": null,\n                    \"lat\": 50.85,\n                    \"lon\": 4.35\n                },\n                \"user_agent\": {\n                    \"raw\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n                    \"browser\": \"IE\",\n                    \"version\": \"11.0\",\n                    \"os\": \"Windows 8.1 \",\n                    \"mobile\": false,\n                    \"platform\": \"Windows 8.1\",\n                    \"device\": \"Unknown\",\n                    \"family\": \"IE\"\n                },\n                \"properties\": {},\n                \"type\": \"desktop\"\n            },\n            \"is_current_device\": false\n        }\n    ]\n}"
										}
									]
								}
							],
							"description": "Castle begins returning `action: 'challenge'` from the /authenticate endpoint for devices that are atypical for that user.",
							"_postman_isSubFolder": true
						},
						{
							"name": "Castle Reacts to Completed Challenge",
							"item": [
								{
									"name": "Challenge Requested is Tracked to Castle Copy",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "f49814e8-617d-4788-958e-fb0c2661ee18",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "5c9ac48d-11fd-4997-949c-3cd0a0fa04fd",
												"exec": [
													"pm.test(\"Status code is 204\", function () {",
													"    pm.response.to.have.status(204);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$challenge.requested\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/534.57.2 (KHTML, like Gecko) Version/5.1.7 Safari/534.57.2\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/track",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"track"
											]
										}
									},
									"response": []
								},
								{
									"name": "Challenge Completed is Tracked to Castle",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "f49814e8-617d-4788-958e-fb0c2661ee18",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "5c9ac48d-11fd-4997-949c-3cd0a0fa04fd",
												"exec": [
													"pm.test(\"Status code is 204\", function () {",
													"    pm.response.to.have.status(204);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$challenge.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/534.57.2 (KHTML, like Gecko) Version/5.1.7 Safari/534.57.2\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/track",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"track"
											]
										}
									},
									"response": []
								},
								{
									"name": "Re-Authenticate with Suspicious Device 3",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "fafd705a-c0fe-4f35-99d1-795b8fd2fa04",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.test('Castle Response: action = \"allow\"', function () {",
													"    pm.expect(castleResponse.action).to.equal('allow');",
													"})",
													"",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1f6b91c9-1b4d-4b11-b519-d751eec538ca",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/534.57.2 (KHTML, like Gecko) Version/5.1.7 Safari/534.57.2\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 3 - Challenge",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"1c997bb8-3dce-4130-a494-4193e7812355-adcaf09b02bd4fb87d76651c\",\n        \"ip\": \"172.112.41.67\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:15:04 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "208"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"b6738703f0175dc52853b6e5b9a00e7e\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "b9a6f8e5-c60d-4f26-9af2-862829d8453f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"challenge\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6ImhZeDNtRVN4RzJFTDdmM21ZcGdweERqNjhTR0ptVmRwIiwidmVyc2lvbiI6MC4xfQ.MlbMcKeo95H0-YpvHXD8OMFydmIVqmNKTZVfS6gWXDM\"\n}"
										}
									]
								}
							],
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "4bbb2387-ba22-47c0-8429-e33a155ba179",
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "07add324-b173-4711-95f0-bdcb32b7b812",
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								}
							],
							"_postman_isSubFolder": true
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "8acb8e4a-43d7-4898-9662-2e3e5724f648",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "cd768b8e-7ba7-4171-8dbf-e923f913d6a2",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"_postman_isSubFolder": true
				},
				{
					"name": "Challenge is Failed",
					"item": [
						{
							"name": "User Establishes Normal Device Behavior",
							"item": [
								{
									"name": "Authenticate with New Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"var expectedAction = \"allow\";",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test(\"Castle returns action: \" + expectedAction, function () {",
													"    pm.expect(castleResponse.action).to.eql(expectedAction);",
													"})",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"var uniqueUserId = uuid.v4();",
													"",
													"var uniqueIpAddress = generateRandomIp();",
													"",
													"function generateRandomIp () {",
													"    var ip1 = randomIpComponent();",
													"    var ip2 = randomIpComponent();",
													"    var ip3 = randomIpComponent();",
													"    var ip4 = randomIpComponent();",
													"    return ip1 + \".\" + ip2 + \".\" + ip3 + \".\" + ip4;",
													"}",
													"",
													"function randomIpComponent () {",
													"    return Math.floor(Math.random() * 255) + 1;",
													"}",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													"pm.environment.set(\"user_id\", uniqueUserId);",
													"pm.environment.set(\"origin_ip_address\", uniqueIpAddress);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										},
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										}
									]
								},
								{
									"name": "Logout from Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"pm.test(\"Status code is 204\", function () {",
													"    pm.response.to.have.status(204);",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$logout.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/track",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"track"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										},
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										}
									]
								},
								{
									"name": "Authenticate with Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"var expectedAction = \"allow\";",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test(\"Castle returns action: \" + expectedAction, function () {",
													"    pm.expect(castleResponse.action).to.eql(expectedAction);",
													"})",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										},
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										}
									]
								},
								{
									"name": "Logout from Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"pm.test(\"Status code is 204\", function () {",
													"    pm.response.to.have.status(204);",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$logout.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/track",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"track"
											]
										},
										"description": "Track a logout event"
									},
									"response": [
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										},
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										}
									]
								},
								{
									"name": "Authenticate with Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"var expectedAction = \"allow\";",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test(\"Castle returns action: \" + expectedAction, function () {",
													"    pm.expect(castleResponse.action).to.eql(expectedAction);",
													"})",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										},
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										}
									]
								},
								{
									"name": "Logout from Device 1",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "36be614e-8b3b-414f-b3f3-5408fb428f63",
												"exec": [
													"pm.test(\"Status code is 204\", function () {",
													"    pm.response.to.have.status(204);",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1b57c18a-e76b-44a2-ae5a-c815f84b87a7",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$logout.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/track",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"track"
											]
										},
										"description": "Track a logout event"
									},
									"response": [
										{
											"name": "call to /v1/authenticate",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"type": "text",
														"value": "application/json"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:18:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "228"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"89047e3fd716aa0c53c759c862effdf8\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "45a896a2-c6c9-42cf-b578-edc03e43f15f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"80fdd50b-8c43-421e-8a08-eb662f00b5b2\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\"\n}"
										},
										{
											"name": "Authenticate with Device 1 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"a97b492d-dcc3-4fc1-87d6-65682955afa5\",\n        \"ip\": \"57.155.181.73\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:13:36 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"0d0cc5b7745d51e805ced0a308f47d3b\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "9c8f9d04-4a58-4e4b-a4c1-0d7fe1343339"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ijd5emdHelVoeHZ5aUdwd2o3ektVUUpuczRNNkVYY0VCIiwidmVyc2lvbiI6MC4xfQ.W9ur52GDZ43Zs3PHgVMKiaPHl4qMBTLf5YvG6OjbRZ0\"\n}"
										}
									]
								}
							],
							"_postman_isSubFolder": true
						},
						{
							"name": "Castle Begins to Challenge Anomalies",
							"item": [
								{
									"name": "Authenticate with New Device 2",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "b834212a-de2b-41c5-b5ce-5e1170e9a3b5",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "ab677012-25f6-40b0-890b-aa282fbea037",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"var uniqueIpAddress = generateRandomIp();",
													"",
													"function generateRandomIp () {",
													"    var ip1 = randomIpComponent();",
													"    var ip2 = randomIpComponent();",
													"    var ip3 = randomIpComponent();",
													"    var ip4 = randomIpComponent();",
													"    return ip1 + \".\" + ip2 + \".\" + ip3 + \".\" + ip4;",
													"}",
													"",
													"function randomIpComponent () {",
													"    return Math.floor(Math.random() * 255) + 1;",
													"}",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													"pm.environment.set(\"origin_ip_address\", uniqueIpAddress);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:13.0) Gecko/20100101 Firefox/13.0.1\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 2 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"d6e688eb-6a8b-4b5e-a2d9-1123c875b4a5-adc2a4e95523609c797ec0c8\",\n        \"ip\": \"232.18.175.111\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:14:38 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"c664b9b352b126fc4e7fa75f5d908fae\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "8bafe1bd-e940-400b-8d11-f7debde0ded1"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6IlpwZXJuNHB4REVGN1doNmNCeERyY3NBMWJrdFp6UGJ6IiwidmVyc2lvbiI6MC4xfQ.eS61Kw1fydgvsXTzaNET3ZgKFmMEO4X5h6j0YqJLQ64\"\n}"
										}
									]
								},
								{
									"name": "Authenticate with New Device 3",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "b834212a-de2b-41c5-b5ce-5e1170e9a3b5",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "ab677012-25f6-40b0-890b-aa282fbea037",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"var uniqueIpAddress = generateRandomIp();",
													"",
													"function generateRandomIp () {",
													"    var ip1 = randomIpComponent();",
													"    var ip2 = randomIpComponent();",
													"    var ip3 = randomIpComponent();",
													"    var ip4 = randomIpComponent();",
													"    return ip1 + \".\" + ip2 + \".\" + ip3 + \".\" + ip4;",
													"}",
													"",
													"function randomIpComponent () {",
													"    return Math.floor(Math.random() * 255) + 1;",
													"}",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													"pm.environment.set(\"origin_ip_address\", uniqueIpAddress);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Opera/9.80 (Windows NT 5.1; U; en) Presto/2.10.229 Version/11.60\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 2 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"d6e688eb-6a8b-4b5e-a2d9-1123c875b4a5-adc2a4e95523609c797ec0c8\",\n        \"ip\": \"232.18.175.111\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:14:38 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"c664b9b352b126fc4e7fa75f5d908fae\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "8bafe1bd-e940-400b-8d11-f7debde0ded1"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6IlpwZXJuNHB4REVGN1doNmNCeERyY3NBMWJrdFp6UGJ6IiwidmVyc2lvbiI6MC4xfQ.eS61Kw1fydgvsXTzaNET3ZgKFmMEO4X5h6j0YqJLQ64\"\n}"
										}
									]
								},
								{
									"name": "Authenticate with New Device 4",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "b834212a-de2b-41c5-b5ce-5e1170e9a3b5",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.environment.set(\"user_id\", castleResponse.user_id);",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "ab677012-25f6-40b0-890b-aa282fbea037",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"var uniqueIpAddress = generateRandomIp();",
													"",
													"function generateRandomIp () {",
													"    var ip1 = randomIpComponent();",
													"    var ip2 = randomIpComponent();",
													"    var ip3 = randomIpComponent();",
													"    var ip4 = randomIpComponent();",
													"    return ip1 + \".\" + ip2 + \".\" + ip3 + \".\" + ip4;",
													"}",
													"",
													"function randomIpComponent () {",
													"    return Math.floor(Math.random() * 255) + 1;",
													"}",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													"pm.environment.set(\"origin_ip_address\", uniqueIpAddress);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Linux; Android 6.0.1; SM-G935S Build/MMB29K; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/55.0.2883.91 Mobile Safari/537.36\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 2 - Allow",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"d6e688eb-6a8b-4b5e-a2d9-1123c875b4a5-adc2a4e95523609c797ec0c8\",\n        \"ip\": \"232.18.175.111\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:14:38 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "204"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"c664b9b352b126fc4e7fa75f5d908fae\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "8bafe1bd-e940-400b-8d11-f7debde0ded1"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"allow\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6IlpwZXJuNHB4REVGN1doNmNCeERyY3NBMWJrdFp6UGJ6IiwidmVyc2lvbiI6MC4xfQ.eS61Kw1fydgvsXTzaNET3ZgKFmMEO4X5h6j0YqJLQ64\"\n}"
										}
									]
								},
								{
									"name": "Authenticate with Suspicious Device",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "fafd705a-c0fe-4f35-99d1-795b8fd2fa04",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.test('Castle Response: action = \"challenge\"', function () {",
													"    pm.expect(castleResponse.action).to.equal('challenge');",
													"})",
													"",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1f6b91c9-1b4d-4b11-b519-d751eec538ca",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"var uniqueIpAddress = generateRandomIp();",
													"",
													"function generateRandomIp () {",
													"    var ip1 = randomIpComponent();",
													"    var ip2 = randomIpComponent();",
													"    var ip3 = randomIpComponent();",
													"    var ip4 = randomIpComponent();",
													"    return ip1 + \".\" + ip2 + \".\" + ip3 + \".\" + ip4;",
													"}",
													"",
													"function randomIpComponent () {",
													"    return Math.floor(Math.random() * 255) + 1;",
													"}",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);",
													"pm.environment.set(\"origin_ip_address\", uniqueIpAddress);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/534.57.2 (KHTML, like Gecko) Version/5.1.7 Safari/534.57.2\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 3 - Challenge",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"1c997bb8-3dce-4130-a494-4193e7812355-adcaf09b02bd4fb87d76651c\",\n        \"ip\": \"172.112.41.67\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:15:04 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "208"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"b6738703f0175dc52853b6e5b9a00e7e\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "b9a6f8e5-c60d-4f26-9af2-862829d8453f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"challenge\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6ImhZeDNtRVN4RzJFTDdmM21ZcGdweERqNjhTR0ptVmRwIiwidmVyc2lvbiI6MC4xfQ.MlbMcKeo95H0-YpvHXD8OMFydmIVqmNKTZVfS6gWXDM\"\n}"
										}
									]
								},
								{
									"name": "Devices are Listed in User Devices",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "7cc3e9aa-047c-4f58-8a05-3ffad9867800",
												"exec": [
													"// Ideally, someday Castle hosts schemas at a public endpoint",
													"// and the test script fetches the schemas and assigns them to",
													"// local env variables via a pre-test script",
													"",
													"// Currently, the schema is copied/pasted from user-device.json",
													"",
													"var responseSchema = {",
													"    \"$schema\": \"http://json-schema.org/draft-07/schema\",",
													"    \"$id\": \"https://castle.io/schemas/user-device.json\",",
													"    \"type\": \"object\",",
													"    \"title\": \"User Device\",",
													"    \"required\": [",
													"        \"total_count\",",
													"        \"data\"",
													"    ],",
													"    \"properties\": {",
													"        \"total_count\": {",
													"            \"type\": \"number\",",
													"            \"examples\": [",
													"                3",
													"            ]",
													"        },",
													"        \"data\": {",
													"            \"type\": \"array\",",
													"            \"uniqueItems\": true,",
													"            \"items\": {",
													"                \"$ref\": \"#/definitions/user_device\"",
													"            }",
													"        }",
													"    },",
													"    \"definitions\": {",
													"        \"user_device\": {",
													"            \"$id\": \"#/definitions/user_device\",",
													"            \"title\": \"Device Schema\",",
													"            \"description\": \"Details about a single device of a user\",",
													"            \"type\": \"object\",",
													"            \"required\": [",
													"                \"token\",",
													"                \"created_at\"",
													"            ],",
													"            \"properties\": {",
													"                \"token\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [",
													"                        \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6ImhZeDNtRVN4RzJFTDdmM21ZcGdweERqNjhTR0ptVmRwIiwidmVyc2lvbiI6MC4xfQ.MlbMcKeo95H0-YpvHXD8OMFydmIVqmNKTZVfS6gWXDM\"",
													"                    ]",
													"                },",
													"                \"created_at\": {",
													"                    \"type\": \"string\",",
													"                    \"format\": \"date-time\",",
													"                    \"examples\": [\"2019-06-01T00:04:40.057Z\"]",
													"                },",
													"                \"last_seen_at\": {",
													"                    \"type\": \"string\",",
													"                    \"format\": \"date-time\",",
													"                    \"examples\": [\"2019-06-03T17:15:04.023Z\"]",
													"                },",
													"                \"approved_at\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"format\": \"date-time\"",
													"                },",
													"                \"escalated_at\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"format\": \"date-time\"",
													"                },",
													"                \"mitigated_at\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"format\": \"date-time\"",
													"                },",
													"                \"context\": {",
													"                    \"$ref\": \"#/definitions/context\"",
													"                },",
													"                \"is_current_device\": {",
													"                    \"type\": \"boolean\"",
													"                }",
													"            }",
													"        },",
													"        \"context\": {",
													"            \"id\": \"#/definitions/context\",",
													"            \"title\": \"Context Schema\",",
													"            \"description\": \"The originating http request context\",",
													"            \"type\": \"object\",",
													"            \"properties\": {",
													"                \"ip\": {",
													"                    \"type\": \"string\",",
													"                    \"format\": \"ipv4\",",
													"                    \"examples\": [\"172.112.41.67\"]",
													"                },",
													"                \"location\": {",
													"                    \"$ref\": \"#/definitions/location\"",
													"                },",
													"                \"user_agent\": {",
													"                    \"$ref\": \"#/definitions/user_agent\"",
													"                },",
													"                \"properties\": {",
													"                    \"type\": \"object\"",
													"                },",
													"                \"type\": {",
													"                    \"type\": \"string\"",
													"                }",
													"            }",
													"        },",
													"        \"location\": {",
													"            \"id\": \"#/definitions/location\",",
													"            \"title\": \"Location Schema\",",
													"            \"description\": \"An object with properties that describe a geographic location\",",
													"            \"type\": \"object\",",
													"            \"properties\": {",
													"                \"country_code\": {",
													"                    \"type\": \"string\",",
													"                    \"minLength\": 2,",
													"                    \"maxLength\": 2,",
													"                    \"examples\": [\"US\"]",
													"                },",
													"                \"country\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"United States\"]",
													"                },",
													"                \"region\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"examples\": [\"California\"]",
													"                },",
													"                \"region_code\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"examples\": [\"CA\"]",
													"                },",
													"                \"city\": {",
													"                    \"type\": [",
													"                        \"null\",",
													"                        \"string\"",
													"                    ],",
													"                    \"examples\": [\"Garden Grove\"]",
													"                },",
													"                \"lat\": {",
													"                    \"type\": \"number\",",
													"                    \"examples\": [33.7832]",
													"                },",
													"                \"lon\": {",
													"                    \"type\": \"number\",",
													"                    \"examples\": [-117.9773]",
													"                }",
													"            }",
													"        },",
													"        \"user_agent\": {",
													"            \"id\": \"#/definitions/user_agent\",",
													"            \"title\": \"User Agent Schema\",",
													"            \"description\": \"The User Agent details of the originating request (i.e. browser, platform, versions, etc)\",",
													"            \"type\": \"object\",",
													"            \"required\": [\"raw\"],",
													"            \"properties\": {",
													"                \"raw\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.1.1 Safari/605.1.15\"]",
													"                },",
													"                \"browser\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Safari\"]",
													"                },",
													"                \"version\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"12.1.1\"]",
													"                },",
													"                \"os\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Mac OS X 10.14.5\"]",
													"                },",
													"                \"mobile\": {",
													"                    \"type\": \"boolean\",",
													"                    \"examples\": [false]",
													"                },",
													"                \"platform\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Mac OS X\"]",
													"                },",
													"                \"device\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Unknown\"]",
													"                },",
													"                \"family\": {",
													"                    \"type\": \"string\",",
													"                    \"examples\": [\"Safari\"]",
													"                }",
													"            }",
													"        }",
													"    }",
													"};",
													"",
													"var deviceToken = pm.environment.get(\"device_token\");",
													"var response = pm.response.json();",
													"",
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"  pm.expect(tv4.validate(response, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.test(\"Last device is listed\", function () {",
													"    pm.expect(response.data[0].token).to.eql(deviceToken);",
													"});",
													"",
													"pm.test(\"Device count is 5\", function () {",
													"    pm.expect(response.total_count).to.equal(5);",
													"})"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "https://api.castle.io/v1/users/{{user_id}}/devices",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"users",
												"{{user_id}}",
												"devices"
											]
										},
										"description": "Devices endpoint lists devices for a user"
									},
									"response": [
										{
											"name": "call to /v1/users/{{user_id}}/devices",
											"originalRequest": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "https://api.castle.io/v1/users/{{user_id}}/devices",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"users",
														"{{user_id}}",
														"devices"
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Fri, 07 Jun 2019 21:23:39 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Transfer-Encoding",
													"value": "chunked"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "Vary",
													"value": "Accept-Encoding"
												},
												{
													"key": "ETag",
													"value": "W/\"758fd3c0d7c17459fea5ee6f2650fee6\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "46942a0f-f16b-46ac-98fb-a4c86af7222c"
												},
												{
													"key": "Server",
													"value": "castle.io"
												},
												{
													"key": "Content-Encoding",
													"value": "gzip"
												}
											],
											"cookie": [],
											"body": "{\n    \"total_count\": 1,\n    \"data\": [\n        {\n            \"token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6Ilo0YXg3eGtRU3d0cDFZN0xaUlM3cG1ZVkRzOTY4U3BWIiwidmVyc2lvbiI6MC4xfQ.Z2VLfWBc23DDRtDiI4EFSZ3Ac4ZL-y5_-9FPMcMa0s8\",\n            \"created_at\": \"2019-06-07T21:18:53.464Z\",\n            \"last_seen_at\": \"2019-06-07T21:18:53.408Z\",\n            \"approved_at\": null,\n            \"escalated_at\": null,\n            \"mitigated_at\": null,\n            \"context\": {\n                \"ip\": \"57.155.181.73\",\n                \"location\": {\n                    \"country_code\": \"BE\",\n                    \"country\": \"Belgium\",\n                    \"region\": null,\n                    \"region_code\": null,\n                    \"city\": null,\n                    \"lat\": 50.85,\n                    \"lon\": 4.35\n                },\n                \"user_agent\": {\n                    \"raw\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n                    \"browser\": \"IE\",\n                    \"version\": \"11.0\",\n                    \"os\": \"Windows 8.1 \",\n                    \"mobile\": false,\n                    \"platform\": \"Windows 8.1\",\n                    \"device\": \"Unknown\",\n                    \"family\": \"IE\"\n                },\n                \"properties\": {},\n                \"type\": \"desktop\"\n            },\n            \"is_current_device\": false\n        }\n    ]\n}"
										}
									]
								}
							],
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"id": "4dbadac5-d54b-4d2d-a14b-0185383555da",
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								},
								{
									"listen": "test",
									"script": {
										"id": "f09a9331-9db7-4bb3-b079-75ca51afe4b0",
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								}
							],
							"_postman_isSubFolder": true
						},
						{
							"name": "Castle Maintains Recommendation when Challenge Fails",
							"item": [
								{
									"name": "Challenge Requested is Tracked to Castle Copy",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "f49814e8-617d-4788-958e-fb0c2661ee18",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "5c9ac48d-11fd-4997-949c-3cd0a0fa04fd",
												"exec": [
													"pm.test(\"Status code is 204\", function () {",
													"    pm.response.to.have.status(204);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"value": "application/json",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$challenge.requested\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/534.57.2 (KHTML, like Gecko) Version/5.1.7 Safari/534.57.2\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/track",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"track"
											]
										}
									},
									"response": []
								},
								{
									"name": "Challenge Failed is Tracked to Castle",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "f49814e8-617d-4788-958e-fb0c2661ee18",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "5c9ac48d-11fd-4997-949c-3cd0a0fa04fd",
												"exec": [
													"pm.test(\"Status code is 204\", function () {",
													"    pm.response.to.have.status(204);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$challenge.failed\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/534.57.2 (KHTML, like Gecko) Version/5.1.7 Safari/534.57.2\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/track",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"track"
											]
										}
									},
									"response": []
								},
								{
									"name": "Re-Authenticate with Suspicious Device 3",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "fafd705a-c0fe-4f35-99d1-795b8fd2fa04",
												"exec": [
													"var responseSchema = {",
													"  \"properties\": {",
													"      \"action\": {",
													"          \"type\": \"string\",",
													"          \"enum\": [\"allow\", \"challenge\", \"deny\"]",
													"      },",
													"      \"user_id\": {",
													"          \"type\": \"string\"",
													"      },",
													"      \"device_token\": {",
													"          \"type\": \"string\"",
													"      }",
													"  }",
													"};",
													"",
													"var castleResponse = pm.response.json();",
													"",
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test('Schema is valid', function() {",
													"    pm.expect(tv4.validate(castleResponse, responseSchema)).to.be.true;",
													"});",
													"",
													"pm.test('Castle Response: action = \"challenge\"', function () {",
													"    pm.expect(castleResponse.action).to.equal('challenge');",
													"})",
													"",
													"pm.environment.set(\"device_token\", castleResponse.device_token);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1f6b91c9-1b4d-4b11-b519-d751eec538ca",
												"exec": [
													"var uuid = require('uuid');",
													"",
													"var uniqueClientId = uuid.v4();",
													"",
													"pm.environment.set(\"client_id\", uniqueClientId);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"name": "Content-Type",
												"type": "text",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"{{user_id}}\",\n    \"user_traits\": {\n        \"email\": \"{{user_id}}@castle.io\"    },\n    \"context\": {\n        \"client_id\": \"{{client_id}}\",\n        \"ip\": \"{{origin_ip_address}}\",\n        \"headers\": {\n        \t\"user_agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/534.57.2 (KHTML, like Gecko) Version/5.1.7 Safari/534.57.2\"\n        }\n    }\n}"
										},
										"url": {
											"raw": "https://api.castle.io/v1/authenticate",
											"protocol": "https",
											"host": [
												"api",
												"castle",
												"io"
											],
											"path": [
												"v1",
												"authenticate"
											]
										},
										"description": "Castle /authenticate endpoint with an 'allow' verdict"
									},
									"response": [
										{
											"name": "Authenticate with Device 3 - Challenge",
											"originalRequest": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"name": "Content-Type",
														"value": "application/json",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n    \"event\": \"$login.succeeded\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"user_traits\": {\n        \"email\": \"johan@castle.io\",\n        \"registered_at\": \"2018-07-10T17:37:39.123Z\"\n    },\n    \"context\": {\n        \"client_id\": \"1c997bb8-3dce-4130-a494-4193e7812355-adcaf09b02bd4fb87d76651c\",\n        \"ip\": \"172.112.41.67\",\n        \"headers\": {\n            \"User-Agent\": \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\",\n            \"Accept\": \"text/html\",\n            \"Accept-Language\": \"en-us,en;q=0.5\",\n            \"Accept-Encoding\": \"gzip, deflate, br\",\n            \"Connection\": \"Keep-Alive\",\n            \"Content-Length\": \"122\",\n            \"Content-Type\": \"application/javascript\",\n            \"Origin\": \"https://castle.io/\",\n            \"Referer\": \"https://castle.io/login\"\n        }\n    }\n}"
												},
												"url": {
													"raw": "https://api.castle.io/v1/authenticate",
													"protocol": "https",
													"host": [
														"api",
														"castle",
														"io"
													],
													"path": [
														"v1",
														"authenticate"
													]
												}
											},
											"status": "Created",
											"code": 201,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Date",
													"value": "Mon, 03 Jun 2019 17:15:04 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "208"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "ETag",
													"value": "W/\"b6738703f0175dc52853b6e5b9a00e7e\""
												},
												{
													"key": "Cache-Control",
													"value": "max-age=0, private, must-revalidate"
												},
												{
													"key": "X-Request-Id",
													"value": "b9a6f8e5-c60d-4f26-9af2-862829d8453f"
												},
												{
													"key": "Server",
													"value": "castle.io"
												}
											],
											"cookie": [],
											"body": "{\n    \"action\": \"challenge\",\n    \"user_id\": \"e325bcdd10ac\",\n    \"device_token\": \"eyJhbGciOiJIUzI1NiJ9.eyJ0b2tlbiI6ImhZeDNtRVN4RzJFTDdmM21ZcGdweERqNjhTR0ptVmRwIiwidmVyc2lvbiI6MC4xfQ.MlbMcKeo95H0-YpvHXD8OMFydmIVqmNKTZVfS6gWXDM\"\n}"
										}
									]
								}
							],
							"_postman_isSubFolder": true
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "8acb8e4a-43d7-4898-9662-2e3e5724f648",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "cd768b8e-7ba7-4171-8dbf-e923f913d6a2",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"_postman_isSubFolder": true
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "27f4b6e8-f577-4270-8733-d0cf5f9be608",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "3eb86373-da0d-4b25-ab51-04127072e564",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		}
	],
	"auth": {
		"type": "basic",
		"basic": [
			{
				"key": "password",
				"value": "{{castle_api_secret}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "a48ba24f-bba4-4444-9720-83b68172dc05",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "cc50dcfe-3354-4f7e-81c9-500466e819f4",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	]
}